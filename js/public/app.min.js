!function(e,r,s){"use strict";angular.module("Tasks",["ngRoute","ngAnimate","ui.select","ngSanitize","dndLists"]).config(["$provide","$routeProvider","$interpolateProvider","$httpProvider",function(t,e,n,s){t.value("Config",{markReadTimeout:500,taskUpdateInterval:6e5}),s.defaults.headers.common.requesttoken=r,e.when("/calendars/:calendarID",{}).when("/calendars/:calendarID/edit/:listparameter",{}).when("/calendars/:calendarID/tasks/:taskID",{}).when("/calendars/:calendarID/tasks/:taskID/settings",{}).when("/calendars/:calendarID/tasks/:taskID/edit/:parameter",{}).when("/collections/:collectionID/tasks/:taskID",{}).when("/collections/:collectionID/tasks/:taskID/settings",{}).when("/collections/:collectionID/tasks/:taskID/edit/:parameter",{}).when("/collections/:collectionID",{}).when("/search/:searchString",{}).when("/search/:searchString/tasks/:taskID",{}).when("/search/:searchString/tasks/:taskID/edit/:parameter",{}).otherwise({redirectTo:"/collections/all"})}]),angular.module("Tasks").run(["$document","$rootScope","Config","$timeout","ListsBusinessLayer","TasksBusinessLayer","SearchBusinessLayer",function(e,n,r,s,a,o,i){var u,c=!1;return(u=function(){var t;return t=function(){return s(u,r.taskUpdateInterval)},c=!0,t()}).call(),OCA.Search.tasks=i,e.click(function(t){n.$broadcast("documentClicked",t)}),moment.locale("details",{calendar:{lastDay:"["+t("tasks","Due yesterday")+"], HH:mm",sameDay:"["+t("tasks","Due today")+"], HH:mm",nextDay:"["+t("tasks","Due tomorrow")+"], HH:mm",lastWeek:"["+t("tasks","Due on")+"] MMM DD, YYYY, HH:mm",nextWeek:"["+t("tasks","Due on")+"] MMM DD, YYYY, HH:mm",sameElse:"["+t("tasks","Due on")+"] MMM DD, YYYY, HH:mm"}}),moment.locale("details_allday",{calendar:{lastDay:"["+t("tasks","Due yesterday")+"]",sameDay:"["+t("tasks","Due today")+"]",nextDay:"["+t("tasks","Due tomorrow")+"]",lastWeek:"["+t("tasks","Due on")+"] MMM DD, YYYY",nextWeek:"["+t("tasks","Due on")+"] MMM DD, YYYY",sameElse:"["+t("tasks","Due on")+"] MMM DD, YYYY"}}),moment.locale("start",{calendar:{lastDay:"["+t("tasks","Started yesterday")+"], HH:mm",sameDay:"["+t("tasks","Starts today")+"], HH:mm",nextDay:"["+t("tasks","Starts tomorrow")+"], HH:mm",lastWeek:"["+t("tasks","Started on")+"] MMM DD, YYYY, HH:mm",nextWeek:"["+t("tasks","Starts on")+"] MMM DD, YYYY, HH:mm",sameElse:function(){return this.diff(moment())>0?"["+t("tasks","Starts on")+"] MMM DD, YYYY, HH:mm":"["+t("tasks","Started on")+"] MMM DD, YYYY, HH:mm"}}}),moment.locale("start_allday",{calendar:{lastDay:"["+t("tasks","Started yesterday")+"]",sameDay:"["+t("tasks","Starts today")+"]",nextDay:"["+t("tasks","Starts tomorrow")+"]",lastWeek:"["+t("tasks","Started on")+"] MMM DD, YYYY",nextWeek:"["+t("tasks","Starts on")+"] MMM DD, YYYY",sameElse:function(){return this.diff(moment())>0?"["+t("tasks","Starts on")+"] MMM DD, YYYY":"["+t("tasks","Started on")+"] MMM DD, YYYY"}}}),moment.locale("reminder",{calendar:{lastDay:t("tasks","[Remind me yesterday at ]HH:mm"),sameDay:t("tasks","[Remind me today at ]HH:mm"),nextDay:t("tasks","[Remind me tomorrow at ]HH:mm"),lastWeek:t("tasks","[Remind me on ]MMM DD, YYYY,[ at ]HH:mm"),nextWeek:t("tasks","[Remind me on ]MMM DD, YYYY,[ at ]HH:mm"),sameElse:t("tasks","[Remind me on ]MMM DD, YYYY,[ at ]HH:mm")}}),moment.locale("tasks",{calendar:{lastDay:"["+t("tasks","Yesterday")+"]",sameDay:"["+t("tasks","Today")+"]",nextDay:"["+t("tasks","Tomorrow")+"]",lastWeek:"DD.MM.YYYY",nextWeek:"DD.MM.YYYY",sameElse:"DD.MM.YYYY"}}),moment.locale("details_short",{calendar:{lastDay:"["+t("tasks","Yesterday")+"]",sameDay:"["+t("tasks","Today")+"]",nextDay:"["+t("tasks","Tomorrow")+"]",lastWeek:"MMM DD, YYYY",nextWeek:"MMM DD, YYYY",sameElse:"MMM DD, YYYY"}}),moment.locale("list_week",{calendar:{lastDay:"["+t("tasks","Yesterday")+"]",sameDay:"["+t("tasks","Today")+"], MMM. DD",nextDay:"["+t("tasks","Tomorrow")+"], MMM. DD",lastWeek:"ddd, MMM. DD",nextWeek:"ddd, MMM. DD",sameElse:"ddd, MMM. DD"}}),moment.locale("en",{relativeTime:{future:t("tasks","in %s"),past:t("tasks","%s ago"),s:t("tasks","seconds"),m:t("tasks","a minute"),mm:t("tasks","%d minutes"),h:t("tasks","an hour"),hh:t("tasks","%d hours"),d:t("tasks","a day"),dd:t("tasks","%d days"),M:t("tasks","a month"),MM:t("tasks","%d months"),y:t("tasks","a year"),yy:t("tasks","%d years")}})}]),angular.module("Tasks").controller("AppController",["$scope","$rootScope","ListsBusinessLayer","$route","Status","$timeout","$location","$routeParams","Loading","SettingsModel","Persistence",function(t,n,r,s,a,o,i,u,c,l,d){return new(function(){function n(n,r,s,a,o,i,u,c,l,d,p){this._$scope=n,this._$listsbusinesslayer=s,this._$route=a,this._$status=o,this._$timeout=i,this._$location=u,this._$routeparams=c,this._Loading=l,this._$settingsmodel=d,this._persistence=p,this._$scope.status=this._$status.getStatus(),this._$scope.route=this._$routeparams,this._$scope.status.newListName="",this._$scope.settingsmodel=this._$settingsmodel,this._$listsbusinesslayer.init().then(function(e){Promise.all(e).then(function(){t.$apply()})}),this._persistence.init(),this._$scope.closeAll=function(t){(e(t.target).closest(".close-all").length||e(t.currentTarget).is(e(t.target).closest(".handler")))&&(angular.isUndefined(n.route.calendarID)?angular.isUndefined(n.route.collectionID)?u.path("/collections/all"):u.path("/collections/"+n.route.collectionID):("name"===n.route.listparameter&&r.$broadcast("cancelEditCalendar",n.route.calendarID),u.path("/calendars/"+n.route.calendarID)),n.status.addingList=!1,n.status.focusTaskInput=!1,n.status.newListName=""),e(t.target).closest(".newList").length||(n.status.addingList=!1,n.status.newListName=""),e(t.target).closest(".add-subtask").length||(n.status.addSubtaskTo=null,n.status.focusSubtaskInput=!1)},this._$scope.isLoading=function(){return l.isLoading()}}return n}())(t,n,r,s,a,o,i,u,c,l,d)}]),angular.module("Tasks").controller("DetailsController",["$scope","$window","TasksModel","TasksBusinessLayer","$route","$location","$timeout","$routeParams","SettingsModel","Loading","ListsModel",function(n,r,s,a,o,i,u,c,l,d,p){return new(function(){function r(r,s,a,o,u,c,l,d,p,m,h){this._$scope=r,this._$window=s,this._$tasksmodel=a,this._$listsmodel=h,this._tasksbusinesslayer=o,this._$route=u,this._$location=c,this._$timeout=l,this._$routeparams=d,this._$settingsmodel=p,this._Loading=m,this._$scope.task=a.getById(r.route.taskID),this._$scope.found=!0,this._$scope.$on("$routeChangeSuccess",function(){var t=a.getByUri(r.route.taskID);angular.isUndefined(t)||null===t?void 0!==r.route.taskID&&(r.found=!1):(r.task=t,r.task.cats=t.categories,r.found=!0)}),this._$scope.settingsmodel=this._$settingsmodel,this._$scope.settingsmodel.add({id:"various",categories:[]}),this._$scope.isAddingComment=!1,this._$scope.timers=[],this._$scope.durations=[{name:t("tasks","week"),names:t("tasks","weeks"),id:"week"},{name:t("tasks","day"),names:t("tasks","days"),id:"day"},{name:t("tasks","hour"),names:t("tasks","hours"),id:"hour"},{name:t("tasks","minute"),names:t("tasks","minutes"),id:"minute"},{name:t("tasks","second"),names:t("tasks","seconds"),id:"second"}],this._$scope.loadTask=function(t){var e=a.getByUri(r.route.taskID);angular.isUndefined(e)||null===e||(r.task=e,r.found=!0)},this._$scope.TaskState=function(){return r.found?"found":m.isLoading()?"loading":null},this._$scope.params=[{name:t("tasks","before beginning"),invert:!0,related:"START",id:"10"},{name:t("tasks","after beginning"),invert:!1,related:"START",id:"00"},{name:t("tasks","before end"),invert:!0,related:"END",id:"11"},{name:t("tasks","after end"),invert:!1,related:"END",id:"01"}],this._$scope.filterParams=function(t){var e;if(e=a.getById(r.route.taskID),!angular.isUndefined(e)&&null!==e)return e.due&&e.start?t:e.start?t.slice(0,2):t.slice(2)},this._$scope.deleteTask=function(t){return l(function(){return o.deleteTask(t).then(function(){return n.$apply()})},500)},this._$scope.triggerUpdate=function(t){o.triggerUpdate(t)},this._$scope.editName=function(t,n){n.calendar.writable&&(e(t.target).is("a")||r.setEditRoute("name"))},this._$scope.editDueDate=function(t,n){n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler"))&&(r.setEditRoute("duedate"),o.initDueDate(n))},this._$scope.editStart=function(t,n){n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler"))&&(r.setEditRoute("startdate"),o.initStartDate(n))},this._$scope.editReminder=function(t,n){if(n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler")))return r.setEditRoute("reminer"),o.initReminder(r.route.taskID)},this._$scope.editNote=function(t,n){n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler"))&&(e(t.target).is("a")||r.setEditRoute("note"))},this._$scope.editPriority=function(t,n){n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler"))&&r.setEditRoute("priority")},this._$scope.editPercent=function(t,n){n.calendar.writable&&e(t.currentTarget).is(e(t.target).closest(".handler"))&&r.setEditRoute("percent")},this._$scope.endEdit=function(t){(e(t.target).closest(".end-edit").length||e(t.currentTarget).is(e(t.target).closest(".handler")))&&r.resetRoute()},this._$scope.endName=function(t){if(13===t.keyCode&&(t.preventDefault(),r.resetRoute()),27===t.keyCode)return r.resetRoute()},this._$scope.setEditRoute=function(t){var e=r.route.calendarID,n=r.route.collectionID;e?i.path("/calendars/"+e+"/tasks/"+r.route.taskID+"/edit/"+t):n&&i.path("/collections/"+n+"/tasks/"+r.route.taskID+"/edit/"+t)},this._$scope.resetRoute=function(){var t=r.route.calendarID,e=r.route.collectionID;t?i.path("/calendars/"+t+"/tasks/"+r.route.taskID):e&&i.path("/collections/"+e+"/tasks/"+r.route.taskID)},this._$scope.deletePercent=function(t){return o.setPercentComplete(t,0)},this._$scope.deleteReminder=function(){return o.deleteReminderDate(r.route.taskID)},this._$scope.toggleCompleted=function(t){t.completed?o.setPercentComplete(t,0):o.setPercentComplete(t,100)},this._$scope.setPercentComplete=function(t,e){o.setPercentComplete(t,e)},this._$scope.toggleStarred=function(t){t.priority>5?o.setPriority(t,0):o.setPriority(t,9)},this._$scope.deletePriority=function(t){return o.setPriority(t,0)},this._$scope.isDue=function(t){return a.due(t)},this._$scope.isOverDue=function(t){return a.overdue(t)},this._$scope.setstartday=function(t){return o.setStart(r.task,moment(t,"MM/DD/YYYY"),"day")},this._$scope.setstarttime=function(t){return o.setStart(r.task,moment(t,"HH:mm"),"time")},this._$scope.deleteStartDate=function(t){o.deleteStartDate(t)},this._$scope.setdueday=function(t){return o.setDue(r.task,moment(t,"MM/DD/YYYY"),"day")},this._$scope.setduetime=function(t){return o.setDue(r.task,moment(t,"HH:mm"),"time")},this._$scope.deleteDueDate=function(t){o.deleteDueDate(t)},this._$scope.isAllDayPossible=function(t){return!angular.isUndefined(t)&&t.calendar.writable&&(t.due||t.start)},this._$scope.toggleAllDay=function(t){o.setAllDay(t,!t.allDay)},this._$scope.setreminderday=function(t){return o.setReminderDate(r.route.taskID,moment(t,"MM/DD/YYYY"),"day")},this._$scope.setremindertime=function(t){return o.setReminderDate(r.route.taskID,moment(t,"HH:mm"),"time")},this._$scope.reminderType=function(t){if(!angular.isUndefined(t))return null===t.reminder?moment(t.start,"YYYYMMDDTHHmmss").isValid()||moment(t.due,"YYYYMMDDTHHmmss").isValid()?"DURATION":"DATE-TIME":t.reminder.type},this._$scope.changeReminderType=function(t){return o.checkReminderDate(t.id),"DURATION"===this.reminderType(t)?t.reminder?t.reminder.type="DATE-TIME":t.reminder={type:"DATE-TIME"}:t.reminder?t.reminder.type="DURATION":t.reminder={type:"DURATION"},o.setReminder(t.id)},this._$scope.setReminderDuration=function(t){return o.setReminder(r.route.taskID)},this._$scope.addComment=function(){var t;r.CommentContent&&(r.isAddingComment=!0,t={tmpID:"newComment"+Date.now(),comment:r.CommentContent,taskID:r.route.taskID,time:moment().format("YYYYMMDDTHHmmss"),name:e("#expandDisplayName").text()},o.addComment(t,function(t){a.updateComment(t),r.isAddingComment=!1},function(){r.isAddingComment=!1}),r.CommentContent="")},this._$scope.sendComment=function(t){if(13===t.keyCode)return r.addComment()},this._$scope.deleteComment=function(t){return o.deleteComment(r.route.taskID,t)},this._$scope.commentStrings=function(){return{button:t("tasks","Comment"),input:t("tasks","Add a comment")}},this._$scope.addCategory=function(t,e){r.task.categories=r.task.cats;var n=r.settingsmodel.getById("various").categories;n.indexOf(t)<0&&n.push(t),o.doUpdate(r.task)},this._$scope.removeCategory=function(t,e){r.task.categories=r.task.cats,o.doUpdate(r.task)}}return r}())(n,r,s,a,o,i,u,c,l,d,p)}]),angular.module("Tasks").controller("ListController",["$scope","$rootScope","$window","$routeParams","ListsModel","TasksBusinessLayer","CollectionsModel","ListsBusinessLayer","$location","SearchBusinessLayer","CalendarService","TasksModel","$timeout",function(n,r,s,a,o,i,u,c,l,d,p,m,h){return new(function(){function r(r,a,o,i,u,c,l,d,p,m,h,f,g){this._$scope=r,this._$window=o,this._$routeParams=i,this._$listsmodel=u,this._$tasksmodel=f,this._$tasksbusinesslayer=c,this._$collectionsmodel=l,this._$listsbusinesslayer=d,this.$location=p,this._$timeout=g,this._$searchbusinesslayer=m,this._$calendarservice=h,this._$scope.collections=this._$collectionsmodel.getAll(),this._$scope.calendars=this._$listsmodel.getAll(),this._$scope.draggedTasks=[],this._$scope.TasksBusinessLayer=this._$tasksbusinesslayer,this._$scope.nameError=!1,this._$scope.color="#31CC7C",this._$scope.deleteMessage=function(e){return t("tasks",'This will delete the Calendar "%s" and all of its entries.').replace("%s",e.displayname)},this._$scope.delete=function(t){return d.delete(t).then(function(){return p.path("/calendars/"+u.getStandardList().uri),n.$apply()})},this._$scope.startCreate=function(){r.status.addingList=!0,r.nameError=!1,e(".hasTooltip").tooltip("hide"),g(function(){e("#newList").focus()},50)},this._$scope.create=function(){r.isNameAllowed(r.status.newListName).allowed&&(r.status.addingList=!1,r.isAddingList=!0,d.add(r.status.newListName,r.color).then(function(t){return p.path("/calendars/"+t.uri),n.$apply()}),r.status.newListName="")},this._$scope.cancelCreate=function(){e(".hasTooltip").tooltip("hide"),r.nameError=!1,r.status.addingList=!1,r.status.newListName=""},this._$scope.startEdit=function(t){r.status.addingList=!1,r.nameError=!1,e(".hasTooltip").tooltip("hide"),t.prepareUpdate(),p.path("/calendars/"+r.route.calendarID+"/edit/name"),g(function(){e("#list_"+t.uri+" input.edit").focus()},50)},this._$scope.showCalDAVUrl=function(t){r.status.addingList=!1,r.nameError=!1,p.path("/calendars/"+r.route.calendarID+"/edit/caldav"),g(function(){e("#list_"+t.uri+" input.caldav").focus()},50)},this._$scope.hideCalDAVUrl=function(){p.path("/calendars/"+r.route.calendarID)},this._$scope.download=function(t){var e=t.url;"/"===e.slice(e.length-1)&&(e=e.slice(0,e.length-1)),e+="?export",s.open(e)},this._$scope.checkNew=function(t,e){r.checkName(t,e)},this._$scope.checkEdit=function(t,e){r.checkName(t,e.displayname,e.uri),27===t.keyCode&&r.cancelEdit(e)},this._$scope.checkName=function(t,n,s){var a=r.isNameAllowed(n,s),o=e(t.currentTarget);a.allowed?(o.tooltip("hide"),r.nameError=!1):(o.attr("title",a.msg).tooltip({placement:"bottom",trigger:"manual"}).tooltip("fixTitle").tooltip("show"),r.nameError=!0),27===t.keyCode&&(t.preventDefault(),o.tooltip("hide"),r.status.addingList=!1,r.status.newListName="",r.nameError=!1)},a.$on("cancelEditCalendar",function(t,e){var n=u.getByUri(e);r.cancelEdit(n)}),this._$scope.cancelEdit=function(t){t.resetToPreviousState(),e(".hasTooltip").tooltip("hide"),r.nameError=!1,p.path("/calendars/"+r.route.calendarID)},this._$scope.saveEdit=function(t){r.isNameAllowed(t.displayname,t.uri).allowed&&(d.rename(t),p.path("/calendars/"+r.route.calendarID))},this._$scope.isNameAllowed=function(e,n){var r={allowed:!1,msg:""};return u.isNameAlreadyTaken(e,n)?r.msg=t("tasks",'The name "%s" is already used.').replace("%s",e):e?r.allowed=!0:r.msg=t("tasks","An empty name is not allowed."),r},this._$scope.getCollectionCount=function(t){var e;return e=m.getFilter(),l.getCount(t,e)},this._$scope.hideCollection=function(t){var e;switch(e=l.getById(t),e.show){case 0:return!0;case 1:return!1;case 2:return this.getCollectionCount(t)<1}},this._$scope.getCollectionString=function(t){var e;return"completed"!==t?(e=m.getFilter(),l.getCount(t,e)):""},this._$scope.getListCount=function(t,e){var n;return n=m.getFilter(),u.getCount(t,e,n)},this._$scope.dragoverList=function(t,n){var r=e(t.target).closest("li.list").attr("calendarID");return u.getByUri(r).writable},this._$scope.dropList=function(t,n,s){if("move"===t.dataTransfer.dropEffect){var a=f.getByUri(s.uri),o=e(t.target).closest("li.list").attr("calendarID"),i=u.getByUri(o);c.changeCalendar(a,i).then(function(){r.$apply()})}return!0},this._$scope.dragoverCollection=function(t,n){if("copy"===t.dataTransfer.effectAllowed||"copyMove"===t.dataTransfer.effectAllowed&&t.ctrlKey)return!1;var r;return"starred"===(r=e(t.target).closest("li.collection").attr("collectionID"))||"completed"===r||"today"===r},this._$scope.dropCollection=function(t,n,r){if("move"===t.dataTransfer.dropEffect){var s=e(t.target).closest("li.collection").attr("collectionID");c.changeCollection(r.uri,s)}return!0}}return r}())(n,r,s,a,o,i,u,c,l,d,p,m,h)}]),angular.module("Tasks").controller("SettingsController",["$scope","$window","Status","$location","CollectionsModel","SettingsBusinessLayer","SettingsModel",function(e,n,r,s,a,o,i){return new(function(){function e(e,n,r,s,a,o,i){this._$scope=e,this._$window=n,this._$status=r,this._$location=s,this._$collectionsmodel=a,this._$settingsbusinesslayer=o,this._$settingsmodel=i,this._$scope.status=this._$status.getStatus(),this._$scope.collections=this._$collectionsmodel.getAll(),this._$scope.settingsmodel=this._$settingsmodel,this._$scope.collectionOptions=[{id:0,name:t("tasks","Hidden")},{id:1,name:t("tasks","Visible")},{id:2,name:t("tasks","Automatic")}],this._$scope.startOfWeekOptions=[{id:0,name:t("tasks","Sunday")},{id:1,name:t("tasks","Monday")},{id:2,name:t("tasks","Tuesday")},{id:3,name:t("tasks","Wednesday")},{id:4,name:t("tasks","Thursday")},{id:5,name:t("tasks","Friday")},{id:6,name:t("tasks","Saturday")}],this._$scope.setVisibility=function(t){var e;return e=a.getById(t),o.setVisibility(t,e.show)},this._$scope.setStartOfWeek=function(){return o.set("various","startOfWeek",i.getById("various").startOfWeek)}}return e}())(e,n,r,s,a,o,i)}]),function(){var r=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};angular.module("Tasks").controller("TasksController",["$scope","$window","$routeParams","TasksModel","ListsModel","CollectionsModel","TasksBusinessLayer","$location","SettingsBusinessLayer","SearchBusinessLayer","VTodo","SettingsModel",function(s,a,o,i,u,c,l,d,p,m,h,f){return new(function(){function a(a,o,i,u,c,l,d,p,m,f,g,y){this._$scope=a,this._$window=o,this._$routeParams=i,this._$tasksmodel=u,this._$listsmodel=c,this._$collectionsmodel=l,this._tasksbusinesslayer=d,this.$location=p,this._settingsbusinesslayer=m,this._searchbusinesslayer=f,this._vtodo=g,this._$scope.tasks=this._$tasksmodel.getAll(),this._$scope.draggedTasks=[],this._$scope.calendars=this._$listsmodel.getAll(),this._$scope.days=[0,1,2,3,4,5,6],this._$scope.isAddingTask=!1,this._$scope.focusInputField=!1,this._$scope.TasksModel=this._$tasksmodel,this._$scope.TasksBusinessLayer=this._tasksbusinesslayer,this._$settingsmodel=y,this._$scope.addTask=function(t,e,n,r){var o;null===n&&(n=""),a.isAddingTask=!0;var i={calendar:null,related:e,summary:t,priority:"0",due:!1,start:!1,reminder:null,completed:!1,complete:"0",note:""};"starred"===(o=a.route.collectionID)||"today"===o||"week"===o||"all"===o||"completed"===o||"current"===o?(i.calendar=e?n:c.getStandardList(),"starred"===a.route.collectionID&&(i.priority="1"),"today"===a.route.collectionID&&(i.due=moment().startOf("day").format("YYYY-MM-DDTHH:mm:ss")),"current"===a.route.collectionID&&(i.start=moment().format("YYYY-MM-DDTHH:mm:ss"))):i.calendar=c.getByUri(a.route.calendarID),i=h.create(i),d.add(i).then(function(t){return a.isAddingTask=!1,a.openDetails(t.uri,null),s.$apply()}),r&&d.setHideSubtasks(r,0),a.status.focusTaskInput=!1,a.status.focusSubtaskInput=!1,a.status.addSubtaskTo=null,a.status.taskName="",a.status.subtaskName=""},this._$scope.getAddString=function(){var e=c.getStandardList();if(angular.isDefined(e))if(angular.isDefined(a.route.collectionID))switch(a.route.collectionID){case"starred":return t("tasks",'Add an important item in "%s"...').replace("%s",e.displayname);case"today":return t("tasks",'Add an item due today in "%s"...').replace("%s",e.displayname);case"all":return t("tasks",'Add an item in "%s"...').replace("%s",e.displayname);case"current":return t("tasks",'Add a current item in "%s"...').replace("%s",e.displayname);case"completed":case"week":return null}else if(angular.isDefined(c.getByUri(a.route.calendarID)))return t("tasks",'Add an item in "%s"...').replace("%s",c.getByUri(a.route.calendarID).displayname)},this._$scope.getSubAddString=function(e){return t("tasks",'Add a subtask to "%s"...').replace("%s",e)},this._$scope.showSubtaskInput=function(t){a.status.addSubtaskTo=t},this._$scope.hideSubtasks=function(t){var e=a.route.taskID,n=u.getDescendantIDs(t);return t.uri!==e&&(!(r.call(n,e)>=0)&&t.hideSubtasks)},this._$scope.showInput=function(){var t=a.route.collectionID,e=c.getByUri(a.route.calendarID);return"completed"!==t&&"week"!==t&&(!angular.isDefined(e)||e.writable)},this._$scope.focusTaskInput=function(){a.status.focusTaskInput=!0},this._$scope.focusSubtaskInput=function(){a.status.focusSubtaskInput=!0},this._$scope.openDetails=function(t,n){var r=a.route.calendarID,o=a.route.collectionID;if(null===n||e(n.currentTarget).is(e(n.target).closest(".handler"))){var i=u.getByUri(t);i.loadedCompleted||d.getAll(i.calendar,!0,i).then(function(){i.loadedCompleted=!0,s.$apply()}),r?p.path("/calendars/"+r+"/tasks/"+t):o&&p.path("/collections/"+o+"/tasks/"+t)}},this._$scope.toggleCompleted=function(t){t.completed?d.setPercentComplete(t,0):d.setPercentComplete(t,100)},this._$scope.toggleStarred=function(t){t.priority>5?d.setPriority(t,0):d.setPriority(t,9)},this._$scope.toggleHidden=function(){return m.toggle("various","showHidden")},this._$scope.filterTasks=function(t,e){return function(t){return u.filterTasks(t,e)}},this._$scope.getSubTasks=function(t,e){var n,r,s,a;for(n=[],s=0,a=t.length;s<a;s++)r=t[s],r.related!==e.uid||r===e||e.hideCompletedSubtasks&&r.completed||n.push(r);return n},this._$scope.hasNoParent=function(t){return function(t){return u.hasNoParent(t)}},this._$scope.hasSubtasks=function(t){return u.hasSubtasks(t.uid)},this._$scope.hasCompletedSubtasks=function(t){return u.hasCompletedSubtasks(t.uid)},this._$scope.toggleSubtasks=function(t){d.setHideSubtasks(t,!t.hideSubtasks)},this._$scope.toggleCompletedSubtasks=function(t){d.setHideCompletedSubtasks(t,!t.hideCompletedSubtasks)},this._$scope.filterTasksByString=function(t){return function(t){var e=f.getFilter();return u.filterTasksByString(t,e)}},this._$scope.filteredTasks=function(){var t;return t=f.getFilter(),u.filteredTasks(t)},this._$scope.dayHasEntry=function(){return function(t){var e,n,r,s,a;for(e=f.getFilter(),r=u.filteredTasks(e),s=0,a=r.length;s<a;s++)if(n=r[s],!n.completed&&u.hasNoParent(n)&&u.taskAtDay(n,t))return!0;return!1}},this._$scope.taskAtDay=function(t,e){return function(t){return u.taskAtDay(t,e)}},this._$scope.filterLists=function(){return function(t){return a.getCount(t.uri,a.route.collectionID)}},this._$scope.getCount=function(t,e){var n=f.getFilter();return c.getCount(t,e,n)},this._$scope.getCountString=function(t,e){var r=f.getFilter();return n("tasks","%n Completed Task","%n Completed Tasks",c.getCount(t,e,r))},this._$scope.checkTaskInput=function(t){27===t.keyCode&&(e(t.currentTarget).blur(),a.status.taskName="",a.status.subtaskName="",a.status.addSubtaskTo=null,a.status.focusTaskInput=!1,a.status.focusSubtaskInput=!1)},this._$scope.getCompletedTasks=function(t){var e=c.getById(t);d.getAll(e,!0).then(function(){c.setLoadedCompleted(t),s.$apply()})},this._$scope.loadedCompleted=function(t){return c.loadedCompleted(t)},this._$scope.sortDue=function(t){return null===t.due?"last":t.due},this._$scope.sortStart=function(t){return null===t.start?"last":t.start},this._$scope.getSortOrder=function(){switch(a.settingsmodel.getById("various").sortOrder){case"due":return a.sortDue;case"start":return a.sortStart;case"priority":return"-priority";case"alphabetically":return"summary";case"manual":return"manual";default:return["completed",a.sortDue,"-priority",a.sortStart,"summary"]}},this._$scope.getSortOrderIcon=function(){switch(a.settingsmodel.getById("various").sortOrder){case"due":case"start":return"ico-calendar";case"priority":return"ico-star";case"alphabetically":return"ico-alphabetically";case"manual":return"ico-manual";default:return"ico-menu"}},this._$scope.setSortOrder=function(t,e){a.settingsmodel.getById("various").sortDirection=a.settingsmodel.getById("various").sortOrder===e?+!a.settingsmodel.getById("various").sortDirection:0,a.settingsmodel.getById("various").sortOrder=e,m.set("various","sortOrder",e),m.set("various","sortDirection",a.settingsmodel.getById("various").sortDirection)},this._$scope.dropAsSubtask=function(t,n,r){if("move"===t.dataTransfer.dropEffect){var s=e(t.target).closest(".task-item").attr("taskID"),a=u.getByUri(n.uri),o=u.getByUri(s);d.changeParent(a,o)}return e(".subtasks-container").removeClass("dropzone-visible"),!0},this._$scope.dropAsRootTask=function(t,n,r){if("move"===t.dataTransfer.dropEffect){var a=u.getByUri(n.uri),o=e(t.target).closest("ol[dnd-list]").attr("collectionID"),i=e(t.target).closest("ol[dnd-list]").attr("calendarID"),l=c.getByUri(i),p=d.makeRootTask(a,l,o);Promise.all(p).then(function(){s.$apply()})}return e(".subtasks-container").removeClass("dropzone-visible"),!0},this._$scope.dragover=function(t,n,r){e(".subtasks-container").removeClass("dropzone-visible");var s=e(t.target).closest("ol[dnd-list]").attr("calendarID");return!!c.getByUri(s).writable&&(e(t.target).closest(".task-item").children(".subtasks-container").addClass("dropzone-visible"),!0)},this._$scope.allow=function(t){return t.calendar.writable?"copyMove":"copy"},this._$scope.dragStart=function(t){("copy"===t.dataTransfer.effectAllowed||"copyMove"===t.dataTransfer.effectAllowed&&t.ctrlKey)&&e(t.target).addClass("copy")},this._$scope.dragEnd=function(t){e(t.target).removeClass("copy")}}return a}())(s,a,o,i,u,c,l,d,p,m,h,f)}])}.call(void 0),angular.module("Tasks").directive("appNavigationEntryUtils",function(){return{restrict:"C",link:function(t,n){var r,s;s=n.siblings(".app-navigation-entry-menu"),r=e(n).find(".app-navigation-entry-utils-menu-button button"),r.click(function(){s.toggleClass("open")}),t.$on("documentClicked",function(t,e){e.target!==r[0]&&s.removeClass("open")})}}}),angular.module("Tasks").directive("autofocusOnInsert",function(){return function(t,e){return e.focus()}}),angular.module("Tasks").directive("avatar",function(){return{restrict:"A",scope:!1,link:function(t,e,n){return n.$observe("userid",function(){if(n.userid)return e.avatar(n.userid,n.size)})}}});var a=function(t,e,n){if(Array.isArray(t)&&(e=t[1],n=t[2],t=t[0]),void 0===t)return[0,0,0];e/=100,n/=100;var r=(1-Math.abs(2*n-1))*e,s=t/60,a=r*(1-Math.abs(s%2-1));s=Math.floor(s);var o,i,u;0===s?(o=r,i=a,u=0):1===s?(o=a,i=r,u=0):2===s?(o=0,i=r,u=a):3===s?(o=0,i=a,u=r):4===s?(o=a,i=0,u=r):5===s&&(o=r,i=0,u=a);var c=n-r/2;return o+=c,i+=c,u+=c,[Math.round(255*o),Math.round(255*i),Math.round(255*u)]},o=function(t,e,n){return Array.isArray(t)&&(e=t[1],n=t[2],t=t[0]),"#"+parseInt(t,10).toString(16)+parseInt(e,10).toString(16)+parseInt(n,10).toString(16)},i=["#31CC7C","#317CCC","#FF7A66","#F1DB50","#7C31CC","#CC317C","#3A3B3D","#CACBCD"],u=function(){return"function"==typeof String.prototype.toHsl?o(a(Math.random().toString().toHsl())):i[Math.floor(Math.random()*i.length)]};angular.module("Tasks").directive("colorpicker",function(){if("function"==typeof String.prototype.toHsl){var t="",e="";i=["15","9","4","b","6","11","74","f","57"],i.forEach(function(n,r){t=n.toHsl(),e=a(t),i[r]=o(e)})}return{scope:{selected:"=",customizedColors:"=colors"},restrict:"AE",templateUrl:OC.filePath("tasks","templates","colorpicker.html"),link:function(t,e,n){t.colors=t.customizedColors||i,t.selected=t.selected||t.colors[0],t.random="#000000",t.randomizeColour=function(){t.random=u(),t.pick(t.random)},t.pick=function(e){t.selected=e}}}}),angular.module("Tasks").directive("confirmation",function(){return{priority:-1,restrict:"A",templateUrl:OC.generateUrl("/apps/tasks/templates/confirmation",{}),scope:{confirmationFunction:"&confirmation",confirmationMessage:"&confirmationMessage"},controller:"ConfirmationController"}}),angular.module("Tasks").controller("ConfirmationController",["$scope","$rootScope","$element","$attrs","$compile","$document","$window","$timeout",function(t,e,n,r,s,a,o,i){return new(function(){function e(e,n,r,s,a,o,i,u){this._$scope=e,this._$scope.countdown=3,r.bind("click",function(t){e.countdown=3,r.removeClass("active");var n=e.confirmationMessage()?e.confirmationMessage():"Are you sure?";r.hasClass("confirmed")||(t.stopPropagation(),e.activate(),r.children(".confirmation-confirm").tooltip({title:n,container:"body",placement:"right"}),r.addClass("confirmed"))}),r.children(".confirmation-confirm").bind("click",function(t){if(r.hasClass("confirmed active"))return void e.confirmationFunction();t.stopPropagation()}),this._$scope.documentClick=function(){r.removeClass("confirmed")},this._$scope.activate=function(){e.countdown?(r.find(".countdown").html(e.countdown+" s"),u(function(){e.activate()},1e3),e.countdown--):r.addClass("active")},o.bind("click",e.documentClick),o.bind("touchend",e.documentClick),t.$on("$destroy",function(){o.unbind("click",e.documentClick),o.unbind("touchend",e.documentClick)})}return e}())(t,e,n,r,s,a,o,i)}]),angular.module("Tasks").directive("datepicker",function(){return{restrict:"A",scope:!1,link:function(t,n,r){return n.datepicker({onSelect:function(e,n){return t["set"+r.datepicker+"day"](e),t.$apply()},beforeShow:function(n,r){var s,a;return s=e(r).datepicker("widget"),a=-Math.abs(e(n).outerWidth()-s.outerWidth())/2+"px",s.css({"margin-left":a}),e("div.ui-datepicker:before").css({left:"100px"}),e(".hasDatepicker").datepicker("option","firstDay",t.settingsmodel.getById("various").startOfWeek)},beforeShowDay:function(e){return 0===moment(e).startOf("day").diff(moment(t.task[r.datepicker],"YYYYMMDDTHHmmss").startOf("day"),"days")?[1,"selected"]:[1,""]},minDate:null})}}}),angular.module("Tasks").directive("ocClickFocus",["$timeout",function(t){return function(n,r,s){var a;if(a=n.$eval(s.ocClickFocus),angular.isDefined(a)&&angular.isDefined(a.selector))return r.click(function(){return angular.isDefined(a.timeout)?t(function(){return e(a.selector).focus()},a.timeout):e(a.selector).focus()})}}]),angular.module("Tasks").directive("timepicker",function(){return{restrict:"A",link:function(e,n,r){return n.timepicker({onSelect:function(t,n){return e["set"+r.timepicker+"time"](t),e.$apply()},myPosition:"center top",atPosition:"center bottom",hourText:t("tasks","Hours"),minuteText:t("tasks","Minutes")})}}}),angular.module("Tasks").directive("watchTop",function(){return{restrict:"A",link:function(t,e,n){return t.$watch(function(){t.divTop=e.prev().outerHeight(!0)})}}}),angular.module("Tasks").filter("counterFormatter",function(){return function(t){switch(!1){case 0!==t:return"";case t<999:return"999+";default:return t}}}),angular.module("Tasks").filter("dateDetails",function(){return function(e){return moment(e,"YYYYMMDDTHHmmss").isValid()?moment(e,"YYYYMMDDTHHmmss").locale(e.isDate?"details_allday":"details").calendar():t("tasks","Set due date")}}),
angular.module("Tasks").filter("dateDetailsShort",function(){return function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()?moment(t,"YYYYMMDDTHHmmss").locale("details_short").calendar():""}}),angular.module("Tasks").filter("dateFromNow",function(){return function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()?moment(t,"YYYYMMDDTHHmmss").fromNow():""}}),angular.module("Tasks").filter("dateTaskList",function(){return function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()?moment(t,"YYYYMMDDTHHmmss").locale("tasks").calendar():""}}),angular.module("Tasks").filter("day",function(){return function(t){return moment().add("days",t).locale("list_week").calendar()}}),angular.module("Tasks").filter("dayTaskList",function(){return function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()?moment(t,"YYYYMMDDTHHmmss").locale("tasks").calendar():""}}),angular.module("Tasks").filter("percentDetails",function(){return function(e){return t("tasks","%s %% completed").replace("%s",e).replace("%%","%")}}),angular.module("Tasks").filter("priorityDetails",function(){return function(e){var n;return n=t("tasks","priority %s: ").replace("%s",e),6==+e||7==+e||8==+e||9==+e?n+" "+t("tasks","high"):5==+e?n+" "+t("tasks","medium"):1==+e||2==+e||3==+e||4==+e?n+" "+t("tasks","low"):t("tasks","no priority assigned")}}),angular.module("Tasks").filter("reminderDetails",function(){return function(e,n){var r,s,a,o;if(angular.isUndefined(e)||null===e)return t("tasks","Remind me");if("DATE-TIME"===e.type&&moment(e.date,"YYYYMMDDTHHmmss").isValid())return moment(e.date,"YYYYMMDDTHHmmss").locale("reminder").calendar();if("DURATION"===e.type&&e.duration){r=t("tasks","Remind me"),o=n.durations;for(var i=0,u=o.length;i<u;i++)a=o[i],+e.duration[a.id]&&(s=1,r+=" "+e.duration[a.id]+" ",r+=function(t,e){return 1==+t.duration[e.id]?e.name:e.names}(e,a));return s?e.duration.params.invert?r+=function(e){return"END"===e?" "+t("tasks","before end"):" "+t("tasks","before beginning")}(e.duration.params.related):r+=function(e){return"END"===e?" "+t("tasks","after end"):" "+t("tasks","after beginning")}(e.duration.params.related):"END"===e.duration.params.related?r+=" "+t("tasks","at the end"):r+=" "+t("tasks","at the beginning"),r}return t("tasks","Remind me")}}),angular.module("Tasks").filter("startDetails",function(){return function(e){return moment(e,"YYYYMMDDTHHmmss").isValid()?moment(e,"YYYYMMDDTHHmmss").locale(e.isDate?"start_allday":"start").calendar():t("tasks","Set start date")}}),angular.module("Tasks").filter("timeTaskList",function(){return function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()?moment(t,"YYYYMMDDTHHmmss").format("HH:mm"):""}}),angular.module("Tasks").service("CalendarService",["DavClient","Calendar",function(e,n){function s(t){return e.propFind(e.buildUrl(OC.linkToRemoteBase("dav")),["{"+e.NS_DAV+"}current-user-principal"],0,{requesttoken:OC.requestToken}).then(function(n){if(!e.wasRequestSuccessful(n.status))throw"CalDAV client could not be initialized - Querying current-user-principal failed";if(!(n.body.propStat.length<1)){var r=n.body.propStat[0].properties;return o._currentUserPrincipal=r["{"+e.NS_DAV+"}current-user-principal"][0].textContent,e.propFind(e.buildUrl(o._currentUserPrincipal),["{"+e.NS_IETF+"}calendar-home-set"],0,{requesttoken:OC.requestToken}).then(function(n){if(!e.wasRequestSuccessful(n.status))throw"CalDAV client could not be initialized - Querying calendar-home-set failed";if(!(n.body.propStat.length<1)){var r=n.body.propStat[0].properties;return o._CALENDAR_HOME=r["{"+e.NS_IETF+"}calendar-home-set"][0].textContent,t()}})}})}function a(t){return parseInt(t.split(" ")[1])}var o=this;this._CALENDAR_HOME=null,this._currentUserPrincipal=null,this._takenUrls=[],this._PROPERTIES=["{"+e.NS_DAV+"}displayname","{"+e.NS_IETF+"}calendar-description","{"+e.NS_IETF+"}calendar-timezone","{"+e.NS_APPLE+"}calendar-order","{"+e.NS_APPLE+"}calendar-color","{"+e.NS_IETF+"}supported-calendar-component-set","{"+e.NS_OWNCLOUD+"}calendar-enabled","{"+e.NS_DAV+"}acl","{"+e.NS_DAV+"}owner","{"+e.NS_OWNCLOUD+"}invite"],this.getAll=function(){return null===this._CALENDAR_HOME?s(function(){return o.getAll()}):e.propFind(e.buildUrl(this._CALENDAR_HOME),this._PROPERTIES,1,{requesttoken:OC.requestToken}).then(function(t){var r=[];if(!e.wasRequestSuccessful(t.status))throw"CalDAV client could not be initialized - Querying calendars failed";for(var s=0;s<t.body.length;s++){var i=t.body[s];if(!(i.propStat.length<1)){o._takenUrls.push(i.href);var u=a(i.propStat[0].status);if(e.wasRequestSuccessful(u)){var c=!1,l=i.propStat[0].properties["{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set"];if(l)for(var d=0;d<l.length;d++){var p=l[d].attributes.getNamedItem("name").textContent.toLowerCase();"vtodo"===p&&(c=!0)}if(c){o._getACLFromResponse(i);var m=i.href.substr(o._CALENDAR_HOME.length).replace(/[^\w\-]+/g,""),h=new n(i.href,i.propStat[0].properties,m);r.push(h)}}}}return r})},this.get=function(t){return null===this._CALENDAR_HOME?s(function(){return o.get(t)}):e.propFind(e.buildUrl(t),this._PROPERTIES,0,{requesttoken:OC.requestToken}).then(function(t){var r=t.body;if(!(r.propStat.length<1)){var s=a(r.propStat[0].status);if(e.wasRequestSuccessful(s)){o._getACLFromResponse(r);var i=r.href.substr(o._CALENDAR_HOME.length).replace(/[^\w\-]+/g,"");return new n(r.href,r.propStat[0].properties,i)}}})},this.create=function(t,n,r){if(null===this._CALENDAR_HOME)return s(function(){return o.create(t,n)});void 0===r&&(r=["vtodo"]);var a=document.implementation.createDocument("","",null),i=a.createElement("c:mkcalendar");i.setAttribute("xmlns:c","urn:ietf:params:xml:ns:caldav"),i.setAttribute("xmlns:d","DAV:"),i.setAttribute("xmlns:a","http://apple.com/ns/ical/"),i.setAttribute("xmlns:o","http://owncloud.org/ns"),a.appendChild(i);var u=a.createElement("d:set");i.appendChild(u);var c=a.createElement("d:prop");u.appendChild(c),c.appendChild(this._createXMLForProperty(a,"displayname",t)),c.appendChild(this._createXMLForProperty(a,"enabled",!0)),c.appendChild(this._createXMLForProperty(a,"color",n)),c.appendChild(this._createXMLForProperty(a,"components",r));var l=i.outerHTML,d=this._suggestUri(t),p=this._CALENDAR_HOME+d+"/",m={"Content-Type":"application/xml; charset=utf-8",requesttoken:OC.requestToken};return e.request("MKCALENDAR",p,m,l).then(function(t){if(201===t.status)return o._takenUrls.push(p),o.get(p).then(function(t){return t.enabled=!0,o.update(t)})})},this.update=function(t){var n=document.implementation.createDocument("","",null),r=n.createElement("d:propertyupdate");r.setAttribute("xmlns:c","urn:ietf:params:xml:ns:caldav"),r.setAttribute("xmlns:d","DAV:"),r.setAttribute("xmlns:a","http://apple.com/ns/ical/"),r.setAttribute("xmlns:o","http://owncloud.org/ns"),n.appendChild(r);var s=n.createElement("d:set");r.appendChild(s);var a=n.createElement("d:prop");s.appendChild(a);var o=t.updatedProperties;t.resetUpdatedProperties();for(var i=0;i<o.length;i++)a.appendChild(this._createXMLForProperty(n,o[i],t[o[i]]));var u=t.url,c=r.outerHTML,l={"Content-Type":"application/xml; charset=utf-8",requesttoken:OC.requestToken};return e.request("PROPPATCH",u,l,c).then(function(e){return t})},this.delete=function(t){return e.request("DELETE",t.url,{requesttoken:OC.requestToken},"").then(function(t){return 204===t.status})},this.share=function(n,s,a,o,i){var u=document.implementation.createDocument("","",null),c=u.createElement("o:share");c.setAttribute("xmlns:d","DAV:"),c.setAttribute("xmlns:o","http://owncloud.org/ns"),u.appendChild(c);var l=u.createElement("o:set");c.appendChild(l);var d=u.createElement("d:href");s===OC.Share.SHARE_TYPE_USER?d.textContent="principal:principals/users/":s===OC.Share.SHARE_TYPE_GROUP&&(d.textContent="principal:principals/groups/"),d.textContent+=a,l.appendChild(d);var p=u.createElement("o:summary");if(p.textContent=t("calendar","{calendar} shared by {owner}",{calendar:n.displayname,owner:n.owner}),l.appendChild(p),o){var m=u.createElement("o:read-write");l.appendChild(m)}var h={"Content-Type":"application/xml; charset=utf-8",requesttoken:r},f=c.outerHTML;return e.request("POST",n.url,h,f).then(function(t){200===t.status&&(i||(s===OC.Share.SHARE_TYPE_USER?n.sharedWith.users.push({id:a,displayname:a,writable:o}):s===OC.Share.SHARE_TYPE_GROUP&&n.sharedWith.groups.push({id:a,displayname:a,writable:o})))})},this.unshare=function(t,n,s){var a=document.implementation.createDocument("","",null),o=a.createElement("o:share");o.setAttribute("xmlns:d","DAV:"),o.setAttribute("xmlns:o","http://owncloud.org/ns"),a.appendChild(o);var i=a.createElement("o:remove");o.appendChild(i);var u=a.createElement("d:href");n===OC.Share.SHARE_TYPE_USER?u.textContent="principal:principals/users/":n===OC.Share.SHARE_TYPE_GROUP&&(u.textContent="principal:principals/groups/"),u.textContent+=s,i.appendChild(u);var c={"Content-Type":"application/xml; charset=utf-8",requesttoken:r},l=o.outerHTML;return e.request("POST",t.url,c,l).then(function(e){return 200===e.status&&(n===OC.Share.SHARE_TYPE_USER?t.sharedWith.users=t.sharedWith.users.filter(function(t){return t.id!==s}):n===OC.Share.SHARE_TYPE_GROUP&&(t.sharedWith.groups=t.sharedWith.groups.filter(function(t){return t.id!==s})),!0)})},this._createXMLForProperty=function(t,e,n){switch(e){case"enabled":var r=t.createElement("o:calendar-enabled");return r.textContent=n?"1":"0",r;case"displayname":var s=t.createElement("d:displayname");return s.textContent=n,s;case"order":var a=t.createElement("a:calendar-color");return a.textContent=n,a;case"color":var o=t.createElement("a:calendar-color");return o.textContent=n,o;case"components":for(var i=t.createElement("c:supported-calendar-component-set"),u=0;u<n.length;u++){var c=t.createElement("c:comp");c.setAttribute("name",n[u].toUpperCase()),i.appendChild(c)}return i}},this._getACLFromResponse=function(t){var n=!1,r=t.propStat[0].properties["{"+e.NS_DAV+"}acl"];if(r)for(var s=0;s<r.length;s++){var a=r[s].getElementsByTagNameNS("DAV:","href");if(0!==a.length&&(a=a[0].textContent)===o._currentUserPrincipal){var i=r[s].getElementsByTagNameNS("DAV:","write");i.length>0&&(n=!0)}}t.propStat[0].properties.canWrite=n},this._isUriAlreadyTaken=function(t){return-1!==this._takenUrls.indexOf(this._CALENDAR_HOME+t+"/")},this._suggestUri=function(t){var e=t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");if(!this._isUriAlreadyTaken(e))return e;if(-1===e.indexOf("-")&&(e+="-1",!this._isUriAlreadyTaken(e)))return e;for(;this._isUriAlreadyTaken(e);){var n=e.lastIndexOf("-"),r=e.substr(0,n),s=e.substr(n+1);s.match(/^\d+$/)?(s=parseInt(s),s++,e=r+"-"+s):""===s?e+="1":e=e="-1"}return e}}]),angular.module("Tasks").service("DavClient",[function(){var t;return t=new dav.Client({baseUrl:OC.linkToRemote("dav/calendars"),xmlNamespaces:{"DAV:":"d","urn:ietf:params:xml:ns:caldav":"c","http://apple.com/ns/ical/":"aapl","http://owncloud.org/ns":"oc","http://nextcloud.com/ns":"nc","http://calendarserver.org/ns/":"cs"}}),angular.extend(t,{NS_DAV:"DAV:",NS_IETF:"urn:ietf:params:xml:ns:caldav",NS_APPLE:"http://apple.com/ns/ical/",NS_OWNCLOUD:"http://owncloud.org/ns",NS_NEXTCLOUD:"http://nextcloud.com/ns",NS_CALENDARSERVER:"http://calendarserver.org/ns/",buildUrl:function(t){return window.location.protocol+"//"+window.location.host+t},wasRequestSuccessful:function(t){return t>=200&&t<=299}}),t}]),angular.module("Tasks").service("ICalFactory",[function(){return{new:function(){var t=new ICAL.Component(["vcalendar",[],[]]),e=angular.element("#app").attr("data-appVersion");return t.updatePropertyWithValue("prodid","-//Nextcloud Tasks v"+e),t}}}]),angular.module("Tasks").factory("Loading",[function(){return new(function(){function t(){this.count=0}return t.prototype.increase=function(){return this.count+=1},t.prototype.decrease=function(){return this.count-=1},t.prototype.getCount=function(){return this.count},t.prototype.isLoading=function(){return this.count>0},t}())}]),function(){angular.module("Tasks").factory("_Model",[function(){return function(){function t(){this._data=[],this._dataMap={},this._filterCache={}}return t.prototype.handle=function(t){var e,n,r,s;for(s=[],n=0,r=t.length;n<r;n++)e=t[n],s.push(this.add(e));return s},t.prototype.add=function(t,e){if(null===e&&(e=!0),e&&this._invalidateCache(),angular.isDefined(this._dataMap[t.id]))return this.update(t,e);this._data.push(t),this._dataMap[t.id]=t},t.prototype.update=function(t,e){var n,r,s,a;null===e&&(e=!0),e&&this._invalidateCache(),n=this.getById(t.id),a=[];for(r in t)s=t[r],"id"!==r&&a.push(n[r]=s);return a},t.prototype.getById=function(t){return this._dataMap[t]},t.prototype.getAll=function(){return this._data},t.prototype.removeById=function(t,e){var n,r,s,a,o,i;for(null===e&&(e=!0),i=this._data,n=a=0,o=i.length;a<o;n=++a)if(s=i[n],s.id===t)return this._data.splice(n,1),r=this._dataMap[t],delete this._dataMap[t],e&&this._invalidateCache(),r},t.prototype.clear=function(){return this._data.length=0,this._dataMap={},this._invalidateCache()},t.prototype._invalidateCache=function(){this._filterCache={}},t.prototype.get=function(t){var e;return e=t.hashCode(),angular.isDefined(this._filterCache[e])||(this._filterCache[e]=t.exec(this._data)),this._filterCache[e]},t.prototype.size=function(){return this._data.length},t}()}])}.call(void 0),angular.module("Tasks").factory("Persistence",["Request","Loading","$rootScope","$q","CalendarService",function(t,e,n,r,s){return new(function(){function t(t,e,n,r){this._request=t,this._Loading=e,this._$rootScope=n,this._CalendarService=r}return t.prototype.init=function(){var t=this;return this.deferred=r.defer(),function(){return t.deferred.resolve()},this.getCollections(),this.getSettings(),this.deferred.promise},t.prototype.getCollections=function(t,e){var n,r,s,a=this;return null===e&&(e=!0),t||(t=function(){}),e?(this._Loading.increase(),s=function(e){return t(),a._Loading.decrease()},n=function(t){return a._Loading.decrease()}):(s=function(e){return t()},n=function(t){}),r={onSuccess:s,onFailure:n},this._request.get("/apps/tasks/collections",r)},t.prototype.getSettings=function(t,e){var n,r,s,a=this;return null===e&&(e=!0),t||(t=function(){}),e?(this._Loading.increase(),s=function(e){return t(),a._Loading.decrease()},n=function(t){return a._Loading.decrease()}):(s=function(e){return t()},n=function(t){}),r={onSuccess:s,onFailure:n},this._request.get("/apps/tasks/settings",r)},t.prototype.setVisibility=function(t,e){var n={routeParams:{collectionID:t,visibility:e}};return this._request.post("/apps/tasks/collection/{collectionID}/visibility/{visibility}",n)},t.prototype.setting=function(t,e,n){var r={routeParams:{type:t,setting:e,value:n}};return this._request.post("/apps/tasks/settings/{type}/{setting}/{value}",r)},t}())(t,e,n,s)}]),angular.module("Tasks").factory("Publisher",["CollectionsModel","SettingsModel",function(t,e){return new(function(){function t(t,e){this._$collectionsmodel=t,this._$settingsmodel=e,this._subscriptions={},this.subscribeObjectTo(this._$collectionsmodel,"collections"),this.subscribeObjectTo(this._$settingsmodel,"settings")}return t.prototype.subscribeObjectTo=function(t,e){var n=this._subscriptions;return n[e]||(n[e]=[]),this._subscriptions[e].push(t)},t.prototype.publishDataTo=function(t,e){var n,r,s,a,o;for(n=this._subscriptions[e]||[],r=[],a=0,o=n.length;a<o;a++)s=n[a],r.push(s.handle(t));return r},t}())(t,e)}]),angular.module("Tasks").factory("RandomStringService",function(){return{generate:function(){return Math.random().toString(36).substr(2)}}}),angular.module("Tasks").factory("Request",["$http","Publisher",function(t,e){return new(function(){function t(t,e){this.$http=t,this.publisher=e,this.count=0,this.initialized=!1,this.shelvedRequests=[],this.initialized=!0,this._executeShelvedRequests()}return t.prototype.request=function(t,e){var n,r,s;return null===e&&(e={}),r={routeParams:{},data:{},onSuccess:function(){return{}},onFailure:function(){return{}},config:{}},angular.extend(r,e),this.initialized?(s=OC.generateUrl(t,r.routeParams),n={url:s,data:r.data},angular.extend(n,r.config),"GET"===n.method&&(n.params=n.data),this.$http(n).then(function(t){return function(e){var n,s,a;s=e.data.data;for(n in s)a=s[n],t.publisher.publishDataTo(a,n);return r.onSuccess(e.data,e.status,e.headers,e.config)}}(this)).catch(function(t){return r.onFailure(t.data,t.status,t.headers,t.config)})):void this._shelveRequest(t,r)},t.prototype.post=function(t,e){return null===e&&(e={}),e.config||(e.config={}),e.config.method="POST",this.request(t,e)},t.prototype.get=function(t,e){return null===e&&(e={}),e.config||(e.config={}),e.config.method="GET",this.request(t,e)},t.prototype.put=function(t,e){return null===e&&(e={}),e.config||(e.config={}),e.config.method="PUT",this.request(t,e)},t.prototype.delete=function(t,e){return null===e&&(e={}),e.config||(e.config={}),e.config.method="DELETE",this.request(t,e)},t.prototype._shelveRequest=function(t,e){var n={route:t,data:e};return this.shelvedRequests.push(n)},t.prototype._executeShelvedRequests=function(){var t,e,n,r,s;for(e=this.shelvedRequests,n=[],r=0,s=e.length;r<s;r++)t=e[r],n.push(this.request(t.route,t.data));return n},t}())(t,e)}]),angular.module("Tasks").factory("Status",[function(){return new(function(){function t(){this._$status={addingList:!1,focusTaskInput:!1}}return t.prototype.getStatus=function(){return this._$status},t}())}]),angular.module("Tasks").service("VTodoService",["DavClient","RandomStringService","$timeout",function(t,e,n){var r=this;this.getAll=function(e,n,r){null===n&&(n=!1),null===r&&(r=!1);var s=document.implementation.createDocument("","",null),a=s.createElement("c:calendar-query");a.setAttribute("xmlns:c","urn:ietf:params:xml:ns:caldav"),a.setAttribute("xmlns:d","DAV:"),a.setAttribute("xmlns:a","http://apple.com/ns/ical/"),a.setAttribute("xmlns:o","http://owncloud.org/ns"),s.appendChild(a);var o=s.createElement("d:prop");a.appendChild(o);var i=s.createElement("d:getetag");o.appendChild(i);var u=s.createElement("c:calendar-data");o.appendChild(u);var c=s.createElement("c:filter");a.appendChild(c);var l=s.createElement("c:comp-filter");l.setAttribute("name","VCALENDAR"),c.appendChild(l);var d=s.createElement("c:comp-filter");d.setAttribute("name","VTODO"),l.appendChild(d);var p=s.createElement("c:prop-filter");if(p.setAttribute("name","COMPLETED"),d.appendChild(p),!n){var m=s.createElement("c:is-not-defined");p.appendChild(m)}if(r){var h=s.createElement("c:prop-filter");h.setAttribute("name","RELATED-TO"),d.appendChild(h);var f=s.createElement("c:text-match"),g=s.createTextNode(r.uid);f.appendChild(g),h.appendChild(f)}var y=e.url,k={"Content-Type":"application/xml; charset=utf-8",Depth:1,requesttoken:OC.requestToken},_=a.outerHTML;return t.request("REPORT",y,k,_).then(function(n){if(t.wasRequestSuccessful(n.status)){var r=[];for(var s in n.body){var a=n.body[s],o=a.propStat[0].properties,i=a.href.substr(a.href.lastIndexOf("/")+1),u={calendar:e,properties:o,uri:i};r.push(u)}return r}})},this.get=function(e,n){var r=e.url+n;return t.request("GET",r,{requesttoken:OC.requestToken},"").then(function(t){return{calendar:e,properties:{"{urn:ietf:params:xml:ns:caldav}calendar-data":t.body,"{DAV:}getetag":t.xhr.getResponseHeader("ETag")},uri:n}})},this.create=function(e,n,s){void 0===s&&(s=!0);var a={"Content-Type":"text/calendar; charset=utf-8",requesttoken:OC.requestToken},o=this._generateRandomUri(),i=e.url+o;return t.request("PUT",i,a,n).then(function(n){return t.wasRequestSuccessful(n.status)?!s||r.get(e,o):(console.log(n),!1)})},this.update=function(e){var r=e.calendar.url+e.uri,s={"Content-Type":"text/calendar; charset=utf-8","If-Match":e.etag,requesttoken:OC.requestToken};return n.cancel(e.timers.update),t.request("PUT",r,s,e.data).then(function(n){return e.etag=n.xhr.getResponseHeader("ETag"),t.wasRequestSuccessful(n.status)})},this.delete=function(e){var n=e.calendar.url+e.uri,r={"If-Match":e.etag,requesttoken:OC.requestToken};return t.request("DELETE",n,r,"").then(function(e){return t.wasRequestSuccessful(e.status)})},this._generateRandomUri=function(){var t="Nextcloud-";return t+=e.generate(),t+=e.generate(),t+=".ics"}}]),angular.module("Tasks").factory("ListsBusinessLayer",["ListsModel","Persistence","TasksBusinessLayer","CalendarService",function(t,e,n,r){return new(function(){function e(t,e,n,r){this._$listsmodel=t,this._persistence=e,this._$tasksbusinesslayer=n,this._$calendarservice=r}return e.prototype.init=function(){return this._$calendarservice.getAll().then(function(e){var r,s,a,o;for(o=[],s=0,a=e.length;s<a;s++)r=e[s],t.add(r),o.push(n.getAll(r));return o})},e.prototype.add=function(e,n){return this._$calendarservice.create(e,n,["vtodo"]).then(function(e){return t.add(e),e})},e.prototype.delete=function(e){return this._$calendarservice.delete(e).then(function(){return t.delete(e)})},e.prototype.rename=function(t){this._$calendarservice.update(t).then(function(t){t.dropPreviousState()})},e}())(t,e,n,r)}]),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("Tasks").factory("SearchBusinessLayer",["ListsModel","Persistence","TasksModel","$rootScope","$routeParams","$location",function(n,r,s,a,o,i){return new(function(){function n(e,n,r,s,a,o){this._$listsmodel=e,this._persistence=n,this._$tasksmodel=r,this._$rootScope=s,this._$routeparams=a,this._$location=o,this.getFilter=t(this.getFilter,this),this.setFilter=t(this.setFilter,this),this.attach=t(this.attach,this),this.initialize(),this._$searchString=""}return n.prototype.attach=function(t){var e=this;return t.setFilter("tasks",function(t){return e._$rootScope.$apply(function(){return e.setFilter(t)})}),t.setRenderer("task",this.renderTaskResult.bind(this)),t.setHandler("task",this.handleTaskClick.bind(this))},n.prototype.setFilter=function(t){this._$searchString=t},n.prototype.getFilter=function(){return this._$searchString},n.prototype.initialize=function(){var t=this;return this.handleTaskClick=function(e,n,r){return t._$location.path("/lists/"+n.calendarid+"/tasks/"+n.id)},this.renderTaskResult=function(n,r){var s;return t._$tasksmodel.filterTasks(r,t._$routeparams.listID)&&t._$tasksmodel.isLoaded(r)?null:(s=e("div.task-item.template"),s=s.clone(),n=e('<tr class="result"></tr>').append(s.removeClass("template")),n.data("result",r),n.find("span.title").text(r.name),r.starred&&n.find("span.task-star").addClass("task-starred"),r.completed&&(n.find("div.task-item").addClass("done"),n.find("span.task-checkbox").addClass("svg-checkmark")),r.complete&&n.find("div.percentdone").css({width:r.complete+"%","background-color":""+t._$listsmodel.getColor(r.calendarid)}),r.note&&n.find("div.title-wrapper").addClass("attachment"),n)},OC.Plugins.register("OCA.Search",this)},n}())(n,r,s,a,o,i)}])}.call(void 0),angular.module("Tasks").factory("SettingsBusinessLayer",["Persistence","SettingsModel",function(t,e){return new(function(){function t(t,e){this._persistence=t,this._$settingsmodel=e}return t.prototype.updateModel=function(){var t;return t=function(){},this._persistence.getCollections(t,!0)},t.prototype.setVisibility=function(t,e){return this._persistence.setVisibility(t,e)},t.prototype.toggle=function(t,e){this._$settingsmodel.toggle(t,e);var n=this._$settingsmodel.getById(t)[e];return this._persistence.setting(t,e,+n)},t.prototype.set=function(t,e,n){return this._persistence.setting(t,e,n)},t}())(t,e)}]),angular.module("Tasks").factory("TasksBusinessLayer",["TasksModel","Persistence","VTodoService","VTodo","$timeout",function(t,e,n,r,s){return new(function(){function e(t,e,n,r,s){this._$tasksmodel=t,this._persistence=e,this._$vtodoservice=n}return e.prototype.getAll=function(e,n,s){return this._$vtodoservice.getAll(e,n,s).then(function(e){var n,s,a,o;for(o=[],s=0,a=e.length;s<a;s++){n=e[s];var i=new r(n.calendar,n.properties,n.uri);o.push(t.ad(i))}return o})},e.prototype.add=function(e){return this._$vtodoservice.create(e.calendar,e.data).then(function(e){var n=new r(e.calendar,e.properties,e.uri);return t.ad(n),n})},e.prototype.getTask=function(e,n){return this._$vtodoservice.get(e,n).then(function(e){return t.ad(e),e})},e.prototype.setPriority=function(t,e){t.calendar.writable&&(t.priority=e,this.doUpdate(t))},e.prototype.setPercentComplete=function(t,e){t.calendar.writable&&(e<100?this.uncompleteParents(t.related):this.completeChildren(t),t.complete=e,this.triggerUpdate(t))},e.prototype.triggerUpdate=function(t,e){e||(e=1e3),t.timers.update&&s.cancel(t.timers.update),t.timers.update=s(function(t){n.update(t)},e,!0,t)},e.prototype.doUpdate=function(t){return this._$vtodoservice.update(t)},e.prototype.completeChildren=function(t){var e,n,r,s=this._$tasksmodel.getChildren(t),a=[];for(n=0,r=s.length;n<r;n++)e=s[n],a.push(this.setPercentComplete(e,100));return a},e.prototype.uncompleteParents=function(t){if(t){var e=this._$tasksmodel.getByUid(t);if(e.completed)return this.setPercentComplete(e,0)}},e.prototype.setHideSubtasks=function(t,e){t.hideSubtasks=e,t.calendar.writable&&this.doUpdate(t)},e.prototype.setHideCompletedSubtasks=function(t,e){t.hideCompletedSubtasks=e,t.calendar.writable&&this.doUpdate(t)},e.prototype.deleteTask=function(e){var n,r,s,a;for(r=this._$tasksmodel.getChildren(e),s=0,a=r.length;s<a;s++)n=r[s],this.deleteTask(n);return this._$vtodoservice.delete(e).then(function(){return t.delete(e)})},e.prototype.momentToICALTime=function(t,e){return e?ICAL.Time.fromDateString(t.format("YYYY-MM-DD")):ICAL.Time.fromDateTimeString(t.format("YYYY-MM-DDTHH:mm:ss"))},e.prototype.initDueDate=function(t){var e=moment(t.start,"YYYY-MM-DDTHH:mm:ss");if(!moment(t.due,"YYYY-MM-DDTHH:mm:ss").isValid()){var n=e.isAfter()?e:moment();return t.allDay?n.startOf("day").add(1,"d"):n.startOf("hour").add(1,"h"),this.setDue(t,n,"all")}},e.prototype.setDue=function(t,e,n){null===n&&(n="day");var r=t.allDay,s=moment(t.start,"YYYY-MM-DDTHH:mm:ss"),a=moment(t.due,"YYYY-MM-DDTHH:mm:ss"),o=a.clone();if("day"===n)moment(o).isValid()?o.year(e.year()).month(e.month()).date(e.date()):o=e.add(12,"h");else if("time"===n)moment(o).isValid()?o.hour(e.hour()).minute(e.minute()):o=e;else{if("all"!==n)return;o=e}(o.isBefore(s)||o.isSame(s))&&(s.subtract(a.diff(o),"ms"),t.start=this.momentToICALTime(s,r)),t.due=this.momentToICALTime(o,r),this.doUpdate(t)},e.prototype.deleteDueDate=function(t){t.due=null,this.doUpdate(t)},e.prototype.initStartDate=function(t){var e=moment(t.start,"YYYY-MM-DDTHH:mm:ss"),n=moment(t.due,"YYYY-MM-DDTHH:mm:ss");if(!e.isValid()){var r=moment().add(1,"h");return n.isBefore(r)&&(r=n.subtract(1,"m")),r.startOf(t.allDay?"day":"hour"),this.setStart(t,r,"all")}},e.prototype.setStart=function(t,e,n){null===n&&(n="day");var r=t.allDay,s=moment(t.due,"YYYY-MM-DDTHH:mm:ss"),a=moment(t.start,"YYYY-MM-DDTHH:mm:ss"),o=a.clone();if("day"===n)moment(o).isValid()?o.year(e.year()).month(e.month()).date(e.date()):o=e.add(12,"h");else if("time"===n)moment(o).isValid()?o.hour(e.hour()).minute(e.minute()):o=e;else{if("all"!==n)return;o=e}(o.isAfter(s)||o.isSame(s))&&(s.add(o.diff(a),"ms"),t.due=this.momentToICALTime(s,r)),t.start=this.momentToICALTime(o,r),this.doUpdate(t)},e.prototype.deleteStartDate=function(t){t.start=null,this.doUpdate(t)},e.prototype.setAllDay=function(t,e){if(t.allDay=e,e){var n=moment(t.due,"YYYY-MM-DDTHH:mm:ss"),r=moment(t.start,"YYYY-MM-DDTHH:mm:ss");(r.isAfter(n)||r.isSame(n))&&(r=moment(n).subtract(1,"day"),t.start=this.momentToICALTime(r,e))}this.doUpdate(t)},e.prototype.initReminder=function(t){var e,n;if(!this.checkReminderDate(t))return n=this._$tasksmodel.getById(t),n.reminder={type:"DURATION",action:"DISPLAY",duration:{token:"week",week:0,day:0,hour:0,minute:0,second:0,params:{invert:!0}}},moment(n.start,"YYYYMMDDTHHmmss").isValid()?(e=n.reminder.duration.params,e.related="START",e.id="10"):moment(n.due,"YYYYMMDDTHHmmss").isValid()?(e=n.reminder.duration.params,e.related="END",e.id="11"):(n.reminder.type="DATE-TIME",n.reminder.date=moment().startOf("hour").add(1,"h").format("YYYYMMDDTHHmmss")),this.setReminder(t)},e.prototype.setReminderDate=function(t,e,n){var r,s,a;if(null===n&&(n="day"),s=this._$tasksmodel.getById(t).reminder,r={type:"DATE-TIME",action:"DISPLAY",duration:null},"day"===n)this.checkReminderDate(t)||null===s?(a=moment(s.date,"YYYYMMDDTHHmmss"),r.action=s.action,a.isValid()&&"DATE-TIME"===s.type?a.year(e.year()).month(e.month()).date(e.date()):a=e.add(12,"h")):a=e.add(12,"h");else{if("time"!==n)return;this.checkReminderDate(t)||null===s?(a=moment(s.date,"YYYYMMDDTHHmmss"),r.action=s.action,a.isValid()&&"DATE-TIME"===s.type?a.hour(e.hour()).minute(e.minute()):a=e):a=e}return r.date=a.format("YYYYMMDDTHHmmss"),this._$tasksmodel.setReminder(t,r),this._persistence.setReminder(t,r)},e.prototype.setReminder=function(t){var e;if(this.checkReminderDate(t))return e=this._$tasksmodel.getById(t).reminder,this._persistence.setReminder(t,e)},e.prototype.checkReminderDate=function(t){var e,n,r,s,a,o,i,u,c;if(u=this._$tasksmodel.getById(t),null!==(o=u.reminder)&&"DURATION"===o.type){if(!o.duration)return!1;if("START"===o.duration.params.related)c="start";else{if("END"!==o.duration.params.related)return!1;c="due"}n=moment(u[c],"YYYYMMDDTHHmmss"),r=o.duration,e={w:r.week,d:r.day,h:r.hour,m:r.minute,s:r.second},n=r.params.invert?n.subtract(e):n.add(e),u.reminder.date=n.format("YYYYMMDDTHHmmss")}else{if(null===o||"DATE-TIME"!==o.type)return!1;if(r=o.duration,n=moment(o.date,"YYYYMMDDTHHmmss"),!n.isValid())return!1;if(r)a="START"===r.params.related?moment(u.start,"YYYYMMDDTHHmmss"):moment(u.due,"YYYYMMDDTHHmmss"),i=this.secondsToSegments(n.diff(a,"seconds")),r.params.invert=i.invert,r.token="week",r.week=i.week,r.day=i.day,r.hour=i.hour,r.minute=i.minute,r.second=i.second;else{if(u.start)a=moment(u.start,"YYYYMMDDTHHmmss"),s="START",e=0;else{if(!u.due)return!0;a=moment(u.due,"YYYYMMDDTHHmmss"),s="END",e=1}i=this.secondsToSegments(n.diff(a,"seconds")),o.duration={token:"week",params:{related:s,invert:i.invert,id:+i.invert+""+e},week:i.week,day:i.day,hour:i.hour,minute:i.minute,second:i.second}}}return!0},e.prototype.secondsToSegments=function(t){var e,n,r,s,a;return t<0?(t*=-1,r=!0):r=!1,a=Math.floor(t/604800),t-=604800*a,e=Math.floor(t/86400),t-=86400*e,n=Math.floor(t/3600),t-=3600*n,s=Math.floor(t/60),t-=60*s,{week:a,day:e,hour:n,minute:s,second:t,invert:r}},e.prototype.deleteReminderDate=function(t){return this._$tasksmodel.setReminder(t,null),this._persistence.setReminder(t,!1)},e.prototype.changeCalendar=function(s,a){if(s.calendar!==a&&a.writable){var o=angular.copy(s);if(o.calendar=a,!t.hasNoParent(o)){t.getByUid(o.related).calendar.uri!==o.calendar.uri&&(o.related=null,e.prototype.setPercentComplete(o,0))}return n.create(a,o.data).then(function(a){var i=new r(a.calendar,a.properties,a.uri);return t.ad(i),n.delete(s).then(function(){t.delete(s);var n,r,a,i=[],u=t.getChildren(o);for(n=0,r=u.length;n<r;n++)a=u[n],a.calendar.uri!==o.calendar.uri&&i.push(e.prototype.changeCalendar(a,o.calendar));return Promise.all(i)})})}return Promise.resolve(!0)},e.prototype.changeCollection=function(t,e){var n=this._$tasksmodel.getById(t);switch(e){case"starred":return n.priority=9,this.doUpdate(n);case"completed":return this.setPercentComplete(n,100);case"uncompleted":return!!n.completed&&this.setPercentComplete(n,0);case"today":return this.setDue(n,moment().startOf("day").add(12,"h"),"all");case"week":case"all":default:return!1}},e.prototype.changeParent=function(t,e){e.calendar.writable&&(t.related=e.uid,e.hideSubtasks=0,e.completed&&!t.completed?this.setPercentComplete(e,0):this.doUpdate(e),e.calendar.uri!==t.calendar.uri?this.changeCalendar(t,e.calendar):this.doUpdate(t))},e.prototype.makeRootTask=function(t,e,n){if(e.writable){var r=[];return t.related=null,"completed"!==n&&t.completed&&(t.complete=0),r.push(this.changeCollection(t.uri,n)),t.calendar!==e?r.push(this.changeCalendar(t,e)):r.push(this.doUpdate(t)),r}},e.prototype.addComment=function(t,e,n){var r;return e||(e=function(){}),n||(n=function(){}),
this._$tasksmodel.addComment(t),r=function(t){return"error"===t.status?n():e(t.data)},this._persistence.addComment(t,r)},e.prototype.deleteComment=function(t,e){return this._$tasksmodel.deleteComment(t,e),this._persistence.deleteComment(t,e)},e}())(t,e,n,r,s)}]),angular.module("Tasks").factory("Calendar",["$rootScope","$filter","$window",function(e,n,r){function s(e,n,r){n.color=n["{http://apple.com/ns/ical/}calendar-color"],void 0!==n.color?9===n.color.length&&(n.color=n.color.substr(0,7)):n.color="#1d2d44",angular.extend(this,{_propertiesBackup:{},_properties:{url:e,uri:r,enabled:"1"===n["{http://owncloud.org/ns}calendar-enabled"],displayname:n["{DAV:}displayname"]||t("tasks","Unnamed"),color:n.color,order:parseInt(n["{http://apple.com/ns/ical/}calendar-order"])||0,components:{vevent:!1,vjournal:!1,vtodo:!1},writable:n.canWrite,shareable:n.canWrite,sharedWith:{users:[],groups:[]},owner:"",loadedCompleted:!1},_updatedProperties:[]}),this._propertiesBackup=angular.copy(this._properties);for(var s=n["{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set"],a=0;a<s.length;a++){var o=s[a].attributes.getNamedItem("name").textContent.toLowerCase();this._properties.components.hasOwnProperty(o)&&(this._properties.components[o]=!0)}var i=n["{http://owncloud.org/ns}invite"];if(void 0!==i)for(var u=0;u<i.length;u++){var c=i[u].getElementsByTagNameNS("DAV:","href");if(0!==c.length){c=c[0].textContent;var l=i[u].getElementsByTagNameNS("http://owncloud.org/ns","access");if(0!==l.length){l=l[0];var d=l.getElementsByTagNameNS("http://owncloud.org/ns","read-write");d=0!==d.length,c.startsWith("principal:principals/users/")?this._properties.sharedWith.users.push({id:c.substr(27),displayname:c.substr(27),writable:d}):c.startsWith("principal:principals/groups/")&&this._properties.sharedWith.groups.push({id:c.substr(28),displayname:c.substr(28),writable:d})}}}var p=n["{DAV:}owner"];void 0!==p&&0!==p.length&&(p=p[0].textContent.slice(0,-1),p.startsWith("/remote.php/dav/principals/users/")&&(this._properties.owner=p.substr(33)))}return s.prototype={get url(){return this._properties.url},get caldav(){return r.location.origin+this.url},get exportUrl(){var t=this.url;return"/"===t.slice(t.length-1)&&(t=t.slice(0,t.length-1)),t+="?export"},get enabled(){return this._properties.enabled},get uri(){return this._properties.uri},get components(){return this._properties.components},set enabled(t){this._properties.enabled=t,this._setUpdated("enabled")},get displayname(){return this._properties.displayname},set displayname(t){this._properties.displayname=t,this._setUpdated("displayname")},get color(){return this._properties.color},set color(t){this._properties.color=t,this._setUpdated("color")},get sharedWith(){return this._properties.sharedWith},set sharedWith(t){this._properties.sharedWith=t},get textColor(){var t,e=this.color;switch(e.length){case 4:return t=e.match(/^#([0-9a-f]{3})$/i)[1],t?this._generateTextColor(17*parseInt(t.charAt(0),16),17*parseInt(t.charAt(1),16),17*parseInt(t.charAt(2),16)):"#fff";case 7:case 9:var n=new RegExp("^#([0-9a-f]{"+(e.length-1)+"})$","i");return t=e.match(n)[1],t?this._generateTextColor(parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)):"#fff";default:return"#fff"}},get order(){return this._properties.order},set order(t){this._properties.order=t,this._setUpdated("order")},get writable(){return this._properties.writable},get shareable(){return this._properties.shareable},get owner(){return this._properties.owner},get loadedCompleted(){return this._properties.loadedCompleted},set loadedCompleted(t){this._properties.loadedCompleted=t},_setUpdated:function(t){-1===this._updatedProperties.indexOf(t)&&this._updatedProperties.push(t)},get updatedProperties(){return this._updatedProperties},resetUpdatedProperties:function(){this._updatedProperties=[]},prepareUpdate:function(){this._propertiesBackup=angular.copy(this._properties)},resetToPreviousState:function(){this._properties=angular.copy(this._propertiesBackup),this._propertiesBackup={}},dropPreviousState:function(){this._propertiesBackup={}},toggleSharesEditor:function(){this.list.editingShares=!this.list.editingShares},_generateTextColor:function(t,e,n){return(299*t+587*e+114*n)/1e3>130?"#000000":"#FAFAFA"}},s}]),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};angular.module("Tasks").factory("CollectionsModel",["TasksModel","_Model",function(t,n){return new(function(t){function n(t){this._$tasksmodel=t,this._nameCache={},n.__super__.constructor.call(this)}return e(n,t),n.prototype.add=function(t,e){if(null===e&&(e=!0),this._nameCache[t.displayname]=t,angular.isDefined(t.id))return n.__super__.add.call(this,t,e)},n.prototype.getCount=function(t,e){var n,r,s,a,o;for(null===e&&(e=""),n=0,s=this._$tasksmodel.filteredTasks(e),a=0,o=s.length;a<o;a++)r=s[a],n+=this._$tasksmodel.filterTasks(r,t)&&!r.related;return n},n}(n))(t)}])}.call(void 0),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};angular.module("Tasks").factory("ListsModel",["TasksModel","_Model",function(t,n){return new(function(t){function n(t){this._$tasksmodel=t,this._tmpUriCache={},this._data=[],this._dataMap={},this._filterCache={}}return e(n,t),n.prototype.add=function(t,e){if(null===e&&(e=!0),angular.isDefined(t.uri)&&angular.isDefined(this.getByUri(t.uri)))return this.update(t,e);angular.isDefined(t.uri)&&(e&&this._invalidateCache(),angular.isDefined(this._dataMap[t.uri])||(this._data.push(t),this._dataMap[t.uri]=t))},n.prototype.getByUri=function(t){return this._dataMap[t]},n.prototype.update=function(t,e){var r;return null===e&&(e=!0),r=this._tmpIdCache[t.tmpID],angular.isDefined(t.id)&&angular.isDefined(r)&&angular.isUndefined(r.id)&&(r.id=t.id,this._dataMap[t.id]=r),t.void=!1,n.__super__.update.call(this,t,e)},n.prototype.delete=function(t,e){var n,r,s,a,o;for(null===e&&(e=!0),o=this._data,n=s=0,a=o.length;s<a;n=++s)if(o[n]===t)return this._data.splice(n,1),r=this._dataMap[t.uri],delete this._dataMap[t.uri],e&&this._invalidateCache(),r},n.prototype.getStandardList=function(){var t;if(this.size())return t=this.getAll(),t[0]},n.prototype.isNameAlreadyTaken=function(t,e){var n,r,s,a,o;for(r=this.getAll(),s=!1,a=0,o=r.length;a<o;a++)n=r[a],n.displayname===t&&n.uri!==e&&(s=!0);return s},n.prototype.getCount=function(t,e,n){var r,s,a,o,i;for(null===n&&(n=""),r=0,a=this._$tasksmodel.filteredTasks(n),o=0,i=a.length;o<i;o++)s=a[o],r+=this._$tasksmodel.filterTasks(s,e)&&s.calendar.uri===t&&!s.related;return r},n.prototype.loadedCompleted=function(t){return!angular.isUndefined(this.getById(t))&&this.getById(t).loadedCompleted},n.prototype.setLoadedCompleted=function(t){this.getById(t).loadedCompleted=!0},n.prototype.getColor=function(t){return angular.isUndefined(this.getById(t))?"#CCCCCC":this.getById(t).calendarcolor},n.prototype.getName=function(t){return angular.isUndefined(this.getById(t))?"":this.getById(t).displayname},n}(n))(t)}])}.call(void 0),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};angular.module("Tasks").factory("SettingsModel",["_Model",function(t){return new(function(t){function n(){this._nameCache={},n.__super__.constructor.call(this)}return e(n,t),n.prototype.add=function(t,e){return null===e&&(e=!0),this._nameCache[t.displayname]=t,angular.isDefined(t.id)?n.__super__.add.call(this,t,e):this._data.push(t)},n.prototype.toggle=function(t,e){var n;n=this.getById(t),this.getById(t)[e]=!n[e]},n}(t))}])}.call(void 0),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};angular.module("Tasks").factory("TasksModel",["_Model",function(t){return new(function(t){function r(){this._tmpIdCache={},r.__super__.constructor.call(this)}return e(r,t),r.prototype.ad=function(t,e){if(null===e&&(e=!0),angular.isDefined(t.uri)&&angular.isDefined(this.getByUri(t.uri)))return this.update(t,e);angular.isDefined(t.uri)&&(e&&this._invalidateCache(),angular.isDefined(this._dataMap[t.uri])||(this._data.push(t),this._dataMap[t.uri]=t))},r.prototype.getByUri=function(t){return this._dataMap[t]},r.prototype.update=function(t,e){var n;return null===e&&(e=!0),e&&this._invalidateCache(),n=this.getByUri(t.uri),n.components=t.components,n.components.toString(),n},r.prototype.removeById=function(t){return r.__super__.removeById.call(this,t)},r.prototype.delete=function(t,e){var n,r,s,a,o;for(null===e&&(e=!0),o=this._data,n=s=0,a=o.length;s<a;n=++s)if(o[n]===t)return this._data.splice(n,1),r=this._dataMap[t.uri],delete this._dataMap[t.uri],e&&this._invalidateCache(),r},r.prototype.removeByList=function(t){var e,n,r,s,a;s=this.getAll(),r=[];for(var o=0,i=s.length;o<i;o++)n=s[o],n.calendarid===t&&r.push(n.id);a=[];for(var u=0,c=r.length;u<c;u++)e=r[u],a.push(this.removeById(e));return a},r.prototype.taskAtDay=function(t,e){var n,r,s,a,o;if(a=moment(t.start,"YYYYMMDDTHHmmss"),r=moment(t.due,"YYYYMMDDTHHmmss"),a.isValid()&&!r.isValid()){if(n=a.diff(moment().startOf("day"),"days",!0),!e&&n<e+1)return!0;if(n<e+1&&n>=e)return!0}if(r.isValid()&&!a.isValid()){if(n=r.diff(moment().startOf("day"),"days",!0),!e&&n<e+1)return!0;if(n<e+1&&n>=e)return!0}if(a.isValid()&&r.isValid()){if(o=a.diff(moment().startOf("day"),"days",!0),s=r.diff(moment().startOf("day"),"days",!0),!e&&(o<e+1||s<e+1))return!0;if(o<e+1&&o>=e&&s>=e)return!0;if(s<e+1&&s>=e&&o>=e)return!0}return!1},r.prototype.isLoaded=function(t){return!!this.getById(t.id)},r.prototype.hasSubtasks=function(t){for(var e=this.getAll(),n=0,r=e.length;n<r;n++){if(e[n].related===t)return!0}return!1},r.prototype.hasCompletedSubtasks=function(t){for(var e=this.getAll(),n=0,r=e.length;n<r;n++){var s=e[n];if(s.related===t&&s.completed)return!0}return!1},r.prototype.hasNoParent=function(t){if(t.related){for(var e=this.getAll(),n=0,r=e.length;n<r;n++){var s=e[n];if(t.related===s.uid&&t!==s)return!1}return!0}return!0},r.prototype.getIdByUid=function(t){for(var e=this.getAll(),n=0,r=e.length;n<r;n++){var s=e[n];if(s.uid===t)return s.id}return!1},r.prototype.getByUid=function(t){for(var e=this.getAll(),n=0,r=e.length;n<r;n++){var s=e[n];if(s.uid===t)return s}return null},r.prototype.getChildren=function(t){var e,n,r;r=this.getAll(),e=[];for(var s=0,a=r.length;s<a;s++)n=r[s],n.related===t.uid&&n!==t&&e.push(n);return e},r.prototype.getDescendantIDs=function(t){var e,n,r;n=this.getChildren(t),r=[];for(var s=0,a=n.length;s<a;s++)e=n[s],r=r.concat(e.uri),r=r.concat(this.getDescendantIDs(e));return r},r.prototype.filterTasks=function(t,e){switch(e){case"completed":return!0===t.completed;case"all":return!1===t.completed;case"current":return!1===t.completed&&this.current(t.start,t.due);case"starred":return!1===t.completed&&t.priority>5;case"today":return!1===t.completed&&(this.today(t.start)||this.today(t.due));case"week":return!1===t.completed&&(this.week(t.start)||this.week(t.due));default:return""+t.calendar.uri==""+e}},r.prototype.filteredTasks=function(t){var e,n,r,s,a;if(r=[],a=this.getAll(),t){for(var o=0,i=a.length;o<i;o++)if(s=a[o],this.filterTasksByString(s,t)){if(this.objectExists(s,r))continue;r.push(s),n=this.getIdByUid(s.related),e=this.getAncestor(n,r),e&&(r=r.concat(e))}}else r=a;return r},r.prototype.objectExists=function(t,e){for(var n=0,r=e.length;n<r;n++){if(e[n].id===t.id)return!0}return!1},r.prototype.filterTasksByString=function(t,e){var r,s,a;s=["name","note","location","categories","comments"],e=e.toLowerCase();for(r in t)if(a=t[r],n.call(s,r)>=0)if("comments"===r){if(this.searchComments(t.comments,e))return!0}else if("categories"===r){if(this.searchCategories(t.categories,e))return!0}else if(-1!==a.toLowerCase().indexOf(e))return!0;return!1},r.prototype.searchComments=function(t,e){for(var n=0,r=t.length;n<r;n++){if(-1!==t[n].comment.toLowerCase().indexOf(e))return!0}return!1},r.prototype.searchCategories=function(t,e){for(var n=0,r=t.length;n<r;n++){if(-1!==t[n].toLowerCase().indexOf(e))return!0}return!1},r.prototype.setReminder=function(t,e){return this.update({id:t,reminder:e})},r.prototype.overdue=function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()&&moment(t,"YYYYMMDDTHHmmss").diff(moment())<0},r.prototype.due=function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()},r.prototype.today=function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()&&moment(t,"YYYYMMDDTHHmmss").diff(moment().startOf("day"),"days",!0)<1},r.prototype.week=function(t){return moment(t,"YYYYMMDDTHHmmss").isValid()&&moment(t,"YYYYMMDDTHHmmss").diff(moment().startOf("day"),"days",!0)<7},r.prototype.current=function(t,e){return!moment(t,"YYYYMMDDTHHmmss").isValid()||moment(t,"YYYYMMDDTHHmmss").diff(moment(),"days",!0)<0||moment(e,"YYYYMMDDTHHmmss").diff(moment(),"days",!0)<0},r.prototype.addComment=function(t){var e;e=this.getById(t.taskID),e.comments?e.comments.push(t):e.comments=[t]},r.prototype.updateComment=function(t){var e,n,r,s,a,o,i;for(r=this.getById(t.taskID),n=0,o=r.comments,i=[],s=0,a=o.length;s<a;s++){if(e=o[s],e.tmpID===t.tmpID){r.comments[n]=t;break}i.push(n++)}return i},r.prototype.deleteComment=function(t,e){var n,r,s,a,o,i,u;for(s=this.getById(t),r=0,i=s.comments,u=[],a=0,o=i.length;a<o;a++){if(n=i[a],n.id===e){s.comments.splice(r,1);break}u.push(r++)}return u},r}(t))}])}.call(void 0),angular.module("Tasks").factory("VTodo",["$filter","ICalFactory","RandomStringService",function(t,e,n){function r(t,e,n){if(angular.extend(this,{calendar:t,data:e["{urn:ietf:params:xml:ns:caldav}calendar-data"],uri:n,etag:e["{DAV:}getetag"]||null,timers:[],loaded:!1}),this.jCal=ICAL.parse(this.data),this.components=new ICAL.Component(this.jCal),0===this.components.jCal.length)throw"invalid calendar"}return r.prototype={get summary(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("summary")},set summary(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("summary",t),this.updateLastModified(),this.data=this.components.toString()},get priority(){return(10-this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("priority"))%10},set priority(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("priority",(10-t)%10),this.updateLastModified(),this.data=this.components.toString()},get complete(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("percent-complete")||0},set complete(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("percent-complete",t),this.updateLastModified(),this.data=this.components.toString(),t<100?(this.completed=null,this.status=0===t?"NEEDS-ACTION":"IN-PROCESS"):(this.completed=ICAL.Time.now(),this.status="COMPLETED")},get completed(){return!!this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("completed")},set completed(t){var e=this.components.getAllSubcomponents("vtodo");t?e[0].updatePropertyWithValue("completed",t):e[0].removeProperty("completed"),this.updateLastModified(),this.data=this.components.toString()},get completed_date(){var t=this.components.getAllSubcomponents("vtodo"),e=t[0].getFirstPropertyValue("completed");return e?e.toJSDate():null},get status(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("status")},set status(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("status",t),this.updateLastModified(),this.data=this.components.toString()},get note(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("description")||""},set note(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("description",t),this.updateLastModified(),this.data=this.components.toString()},get uid(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("uid")||""},get related(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("related-to")||null},set related(t){var e=this.components.getAllSubcomponents("vtodo");t?e[0].updatePropertyWithValue("related-to",t):e[0].removeProperty("related-to"),this.updateLastModified(),this.data=this.components.toString()},get hideSubtasks(){return+this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("x-oc-hidesubtasks")||0},set hideSubtasks(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("x-oc-hidesubtasks",+t),this.updateLastModified(),this.data=this.components.toString()},get hideCompletedSubtasks(){return+this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("x-oc-hidecompletedsubtasks")||0},set hideCompletedSubtasks(t){this.components.getAllSubcomponents("vtodo")[0].updatePropertyWithValue("x-oc-hidecompletedsubtasks",+t),this.updateLastModified(),this.data=this.components.toString()},get reminder(){return null},get categories(){var t=this.components.getAllSubcomponents("vtodo"),e=t[0].getFirstProperty("categories");return e?e.getValues():[]},set categories(t){var e=this.components.getAllSubcomponents("vtodo"),n=e[0].getFirstProperty("categories");if(t.length>0)if(n)n.setValues(t);else{var r=new ICAL.Property("categories");r.setValues(t),n=e[0].addProperty(r)}else e[0].removeProperty("categories");this.updateLastModified(),this.data=this.components.toString()},get start(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("dtstart")},set start(t){var e=this.components.getAllSubcomponents("vtodo");t?e[0].updatePropertyWithValue("dtstart",t):e[0].removeProperty("dtstart"),this.updateLastModified(),this.data=this.components.toString()},get due(){return this.components.getAllSubcomponents("vtodo")[0].getFirstPropertyValue("due")},set due(t){var e=this.components.getAllSubcomponents("vtodo");t?e[0].updatePropertyWithValue("due",t):e[0].removeProperty("due"),this.updateLastModified(),this.data=this.components.toString()},get allDay(){var t=this.components.getAllSubcomponents("vtodo"),e=t[0].getFirstPropertyValue("dtstart"),n=t[0].getFirstPropertyValue("due"),r=n||e;return null!==r&&r.isDate},set allDay(t){var e=this.components.getAllSubcomponents("vtodo"),n=e[0].getFirstPropertyValue("dtstart");n&&(n.isDate=t,e[0].updatePropertyWithValue("dtstart",n));var r=e[0].getFirstPropertyValue("due");r&&(r.isDate=t,e[0].updatePropertyWithValue("due",r)),this.updateLastModified(),this.data=this.components.toString()},get comments(){return null},get loadedCompleted(){return this.loaded},set loadedCompleted(t){this.loaded=t},updateLastModified:function(){var t=this.components.getAllSubcomponents("vtodo");t[0].updatePropertyWithValue("last-modified",ICAL.Time.now()),t[0].updatePropertyWithValue("dtstamp",ICAL.Time.now())}},r.create=function(t){var s=e.new(),a=new ICAL.Component("vtodo");return s.addSubcomponent(a),a.updatePropertyWithValue("created",ICAL.Time.now()),a.updatePropertyWithValue("dtstamp",ICAL.Time.now()),a.updatePropertyWithValue("last-modified",ICAL.Time.now()),a.updatePropertyWithValue("uid",n.generate()),a.updatePropertyWithValue("summary",t.summary),a.updatePropertyWithValue("priority",t.priority),a.updatePropertyWithValue("percent-complete",t.complete),a.updatePropertyWithValue("x-oc-hidesubtasks",0),t.related&&a.updatePropertyWithValue("related-to",t.related),t.note&&a.updatePropertyWithValue("description",t.note),t.due&&a.updatePropertyWithValue("due",t.due),t.start&&a.updatePropertyWithValue("dtstart",t.start),new r(t.calendar,{"{urn:ietf:params:xml:ns:caldav}calendar-data":s.toString(),"{DAV:}getetag":null},null)},r}])}(jQuery,oc_requesttoken);
//# sourceMappingURL=app.min.js.map
